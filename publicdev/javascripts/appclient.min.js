function JQ_click(a,b,c){$(""+b+a).on("click",c)}function soultimer(a){var b;if(window=window||"",""!==window)return function(){b=window.setInterval(function(){a(b)},8e3)}}var DISABLE_CONTEXT_MENU=!0,FPS=60,dev=1,Player=require("./player.js"),pixidisplay=require("pixi-display"),Keys=require("./keyboard.js"),JQuery=$=require("jquery"),http=require("http"),Renderer=require("./renderer.js"),Game=require("./game.js"),Skinner=require("./skinner.js"),Social=require("./social.js"),Conf=require("./gameConf.js"),port=0,CONN_STR="",ipadd="";dev?(ipadd="localhost",port=519,CONN_STR="http://"+ipadd+":"+port):(port=3e3,ipadd="172.104.32.148",CONN_STR="http://"+ipadd+":"+port),Conf.MAIN_CONN=CONN_STR;var FastMath=require("./fastmath.js"),fMath=new FastMath,gameEvents=require("./events.js"),LZStr=require("./lz-string.js"),Taunts=require("./tauntm.js"),Leaderboard=require("./leaderboard.js"),ReqServer=require("./reqserver.js"),roomId=0,player=null,chartdata=[],tttt=0,ctx,mmax=Math.max,mmin=Math.min,CURR_REND={NONE:0,WORLD:1,GAME:2},S_RU=Conf.EVENTS.S_RU,S_BP=Conf.EVENTS.S_BP,S_OPEN=Conf.EVENTS.S_OPEN,S_MT=Conf.EVENTS.S_MT,S_TK=Conf.EVENTS.S_TK,S_WDD=Conf.EVENTS.S_WDD,S_WDT=Conf.EVENTS.S_WDT,S_SMC=Conf.EVENTS.S_SMC,S_ERR=Conf.EVENTS.S_ERR,kkeys=Object.keys,TIP_INTERVAL=600,TIP_RAND_START=4,TIP_RAND_DEL=5,TIP_DELTA=5,pushArr=function(a,b){a[a.length]=b},spliceOne=function(a,b){var c=a.length;if(c){for(;b<c;)a[b]=a[b+1],b++;a.length--}},AppClient=function(){function a(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()}function b(){var a=i.camera;k.on("m:lc",function(){if(player){var a=performance.now().toFixed(0);d.send("c.md",{s:a})}}.bind(this)),k.on("m:rc",function(a){if(player){var b=performance.now().toFixed(0);player.rightClick(a.o),d.send("c.rc",{x:a.x,y:a.y,o:a.o,s:b})}}.bind(this)),k.on("m:lc_",function(){}.bind(this)),k.on("m:rc_",function(a){if(player){var b=performance.now().toFixed(0);player.rightClick(a.o),d.send("c.rc",{x:a.x,y:a.y,o:a.o,s:b})}}.bind(this)),k.on("c:f",function(){if(player){var a=performance.now().toFixed(0),b=Date.now(),c=b-this.lastFireTime;this.fireDelta+=c,this.fireDelta>20&&(d.send("c.f",{s:a}),this.fireDelta=0),this.lastFireTime=b}}.bind(this)),k.on("bot",function(){d.send("c.tempdead")}.bind(this)),k.on("split",function(){d.send("c.split")}.bind(this)),k.on("mouseMove",function(){var b=this,c=a.root;return function(e){if(player&&a){var f=c.position,g=performance.now().toFixed(0),h=Date.now(),i=h-b.lastTime;if(b.timespan+=i,b.timespan>100){var j=player.collectClientInput(e.x-f.x,e.y-f.y,g);e.y,f.y,e.x,f.x;d.send("c.i",{val:Math.round(100*j[0])/100,stamp:g,d:j[1]}),b.timespan=0}b.lastTime=h}}}.bind(this)())}var c,d,e,f,g=!1,h=[],i=null,j=null,k=null,l="",m=!0,n="",o="",p=Conf.GRAPHICS[0],q=p;this.isInside=!1,this.activeShopElements={},this.timespan=0,this.xtoken="",this.restart=!1,this.latency=0,this.online=!1,this.uid="",this.pname="",this.fireDelta=0,this.lastTime=Date.now(),this.lastFireTime=Date.now(),this.otherPlayers=[],this.discData=[],this.activeSkinColor="0xFFE5C8",this.otherPlayersKeys=[],this.gd_load=!1,curMode_element=null,lastMode_element=null,this.cur_m_str="",this.reqServer=new ReqServer(this),this.skinner=null,this.latency,this.scrollInterval;var r=[];this.getPrimus=function(){return d},this.getTips=function(){return h},this.topScroll=function(a,b){var c=""+b,d=window.innerWidth;if(parseInt(a.css("margin-left"))<=-c){var e=""+d;a.css("margin-left",e+"px")}a.css("margin-left","-=1px")},this.startScrolling=function(){this.scrollInterval&&clearInterval(this.scrollInterval);var a=$(".pl-container"),b=a.width();this.scrollInterval=setInterval(this.topScroll.bind(this),20,a,b),r.push(this.scrollInterval)},this.logout=function(){this.gameSparkServer.logOut()},this.showProfile=function(a){$(".ol-profile-main").show(),$(".ol-profile-closebtn").off("click"),$(".ol-profile-closebtn").on("click",function(){$(".ol-profile-main").hide()})},this.addJQEvents=function(a){var b=a;$(document).ready(function(){window.innerWidth,window.innerHeight;$(window).resize(function(){var a=.35*$(document).width(),c=Math.max(432,.95*a);$(".delTaunt").css("left",c+"px");var e=b.getRenderer().winResize.bind(b.getRenderer())();d.send("c.wr",e)}),$(".mm-profile-btn").off("click").on("click",function(a){a.stopImmediatePropagation(),$("#ol-profile-window").show(),b.showProfile()}),JQ_click("areas-header",".",function(){}),JQ_click("mm-modes",".",function(){$(".mm-mode-outer").slideToggle("fast")}),$(document).on("contextmenu","#canvas",function(a){return!DISABLE_CONTEXT_MENU}),$(document).on("click",function(a){var b=$(".tn-overlay"),c=$(".tnovout");b.is(a.target)||0!==b.has(a.target).length||c.hide()}),$(document).mouseup(function(a){var b=$(".tauntdialoglmain"),c=$(".tauntdialogmain"),d=$(".ol-signup"),e=$(".taunt-txt i"),f=$(".main-symbols"),g=$(".signinpanel-inner i"),h=$(".mm-modes"),i=$(".tiny-right"),j=$(".setting-tip"),k=$(".mm-mode-outer");d.is(a.target)||0!==d.has(a.target).length||$(".ol-signup-main").hide(),h.is(a.target)||0!==h.has(a.target).length||k.is(a.target)||0!==k.has(a.target).length||k.slideUp("fast"),b.is(a.target)||0!==b.has(a.target).length||e.is(a.target)||0!==e.has(a.target).length||b.parent("#tauntlocaldialog").hide(),c.is(a.target)||0!==c.has(a.target).length||e.is(a.target)||0!==e.has(a.target).length||c.parent("#tauntdialog").hide(),j.is(a.target)||0!==j.has(a.target).length||i.is(a.target)||0!==i.has(a.target).length||(setTimeout(function(){$(".game-controls").hide()},200),$(".user-settings").hide()),g.is(a.target)||f.is(a.target)||0!==f.has(a.target).length||(g.removeClass("glyphicon glyphicon-chevron-up").addClass("glyphicon glyphicon-chevron-down"),f.hide())}),JQ_click("back_game_btn","#",function(){b.showInt(),$(this).closest("#back_game").hide()}),JQ_click("cityhis-lg-btn","#",function(){var a=$("#location-selector :selected").text().split("(")[0].trim();b.cityHistoryGlobal(a)}),JQ_click("moved",".",function(){$(".top-pl").hide(),$(".bbtp").fadeIn("100")}),JQ_click("bbtp",".",function(){$(".top-pl").show(),$(this).hide()}),JQ_click("soul-lg-btn","#",function(){$(".ol-signup-main").show()}),JQ_click("mm-log-btn",".",function(){b.logOutGlobal()}),JQ_click("play-btn","#",function(){g?b.addPlayerToGame($(this).text()):alert("please select a region first")}),JQ_click("city-detail-btn",".",function(a){b.showCityDetailsModal()}),null!==$&&(String.prototype.capitalizeFirstLetter=function(){return this.charAt(0).toUpperCase()+this.slice(1)},$.fn.extend({disableSelection:function(){this.each(function(){void 0!==this.onselectstart?this.onselectstart=function(){return!1}:void 0!==this.style.MozUserSelect?this.style.MozUserSelect="none":this.onmousedown=function(){return!1}})}}),$.extend($.easing,{customEasing:function(a,b,c,d,e){return b/=e,b--,-d*(b*b*b*b-1)+c}})),$("#soulbox .box1").css({top:"0px"}),$("#soulbox .box2").css({top:"0px"}),$("#soulbox .box3").css({top:"0px"})})},this.verf_capt=function(a,b){a&&b&&b()},this.showCapt=function(){"undefined"!=typeof grecaptcha&&grecaptcha.reset(),$(".gcaptcha").show()},this.cleanMem=function(){for(var a=0;a<r.length;a++)clearInterval(r[a]),r[a]=void 0;r=[],this.scrollInterval&&clearInterval(this.scrollInterval);for(var b=window.setTimeout(function(){},0);b--;)window.clearTimeout(b)},this.hideInt=function(){$("#footer").hide(),$("#canvas").show(),$("#overlays").fadeOut("100"),$(".tiny-window").hide(),clearInterval(this.tiploop),$(document).unbind("keyup")},this.hideGameView=function(){$("#footer").hide(),$("#overlays").fadeOut("100"),$(".tiny-window").hide(),$("#back_game").show(),$("#canvas").show()},this.showInt=function(){$("#canvas").fadeOut(1200),setTimeout(function(){$("#footer").fadeIn(1e3),$("#overlays").fadeIn(1e3),$(".tiny-window").fadeIn(1e3)},1e3),this.addKeyUpEvent()},this.addUITimer=function(){soultimer(this.cityPlayersUI_Update)()},this.cityPlayersUI_Update=function(a){if(e&&e.Running())return void window.clearInterval(a);d?d.send("c.ru"):c&&c.send("c.ru")},this.syncAddTaunts=function(a){j.addMultiTauntSync(a),this.addTauntTemplates()},this.syncTauntCB=function(a){var b=!1,c=this;setTimeout(function(){!1===b&&($(".soulsyncing span").text("Sync Error."),setTimeout(function(){$("#soulsync").hide()},1e3))},4e3),(""+a.tauntslen).length>0&&(b=!0,$(".soulsyncing span").text("Sync Finished"),setTimeout(function(){$("#soulsync").hide()},1e3)),a.error?(b=!0,$(".user-taunts .taunts-header i.tstatus").css("color","yellow"),$(".soulsyncing span").text("Sync Error"),setTimeout(function(){$("#soulsync").hide()},1e3)):$(".user-taunts .taunts-header i.tstatus").css("color","green"),a.ts&&c.syncAddTaunts(a.ts)},this.commonLoggedOut=function(){},this.isOnline=function(a){this.online=a},this.setTagsFromServ=function(a){this.addTauntTemplates(a)},this.GS_fbConnect=function(a,b,d,e){this.uid=d,this.pname=b;var f={name_:b,url_:e};this.loginSucc("fb",f);var g=this.online,h=this,i=Conf.T_ONLINE_MSG;g?$(".user-taunts .taunts-header").html("Tags").append('<i style="color:green;" data-toggle="tooltip" data-placement="top" class="tstatus glyphicon glyphicon-ok-sign"></i>').append('<i style="color:white;" data-toggle="tooltip" data-placement="top" class="tstatusgear glyphicon glyphicon-cog"></i>'):(i=Conf.T_OFFLINE_MSG,$(".user-taunts .taunts-header").html("Tags").append('<i data-toggle="tooltip" data-placement="top"  class="tstatus glyphicon  glyphicon-exclamation-sign"></i>')),$(".user-taunts .taunts-header i.tstatus").css("color","yellow"),c.send("c.sls",{pname:b,id:d});var k=j.getLocalTaunts_server();this.rqServ().GS_fbConnect(a,b,d,k,this.setTagsFromServ.bind(h)),$(".user-taunts .taunts-header i.tstatus").prop("title",i),$(".user-taunts .taunts-header i.tstatusgear").off("click").on("click",function(){$("#tauntdialog").show(),$("#taunt-dialog-dsc").off("click").on("click",function(){h.clearTaunts(),$("#tauntdialog").hide()}),$("#taunt-dialog-dcc").off("click").on("click",function(){h.clearTauntsLocal(),$("#tauntdialog").hide(),h.addTauntTemplates()})}),$(".user-taunts .taunts-header i.tstatus").off("click").on("click",function(){$("#soulsync").show(),$(".soulsyncing span").text("Syncing"),setTimeout(function(){$(".soulsyncing span").text("Sync Error."),setTimeout(function(){$("#soulsync").hide()},1e3)},4e3);var a=j.getLocalTaunts_server();h.rqServ().syncTags(h.pname,h.uid,a)})},this.GS_gooConnect=function(a){this.getServer().GS_gooConnect(a)},this.gameSparkInit=function(a,b){},this.playerLoggedOut=function(){$(".secrow").show(),$(".secrow-logged").hide(),$(".user-header-in img").attr("src",""),$(".mm-mode-outer").hide(),$(".user-header-in span.user-heading").text("Guest")},this.cityHistoryGlobal=function(a){$(".ol-cityhis-main").show(),$("#ol-cityhis-title").text(""+a),$(".ol-cityhis-closebtn").off("click").on("click",function(){$(".ol-cityhis-main").hide()})},this.logoutText=function(){$(".mm-log-btn").text("Logout")},this.logOutGlobal=function(){var a=this;social.logOut(this.loginType,function(b,c){if("fb"===b){""!==(c.authResponse||"")&&($(".mm-log-btn").hide(),a.playerLoggedOut())}})},this.updateTopPlayers=function(a){for(var b={topplayers:[]},c=0;c<a.length;c++)b.topplayers.push({name:a[c]});var d=Soulcrashers.Templates.topplayer;$(".pl-container").html(d(b)),this.startScrolling()},this.skinBoxMoveCommon=function(a){},this.showNoContentTabData=function(){},this.skinBoxLRCommon=function(){var a=$(".ol-skins-lists").find(".tab-active").data("tab"),b=".tab-"+a+"-data",c=$(b).width(),d=$(b).find("ul:first").css("margin-left"),e=Math.ceil($(b).find("ul:first li").length/3);return e<=0?($(b).find(".pright").addClass("disableRL"),$(b).find(".pleft").addClass("disableRL"),void this.showNoContentTabData(b)):1===e?($(b).find(".pright").addClass("disableRL"),void $(b).find(".pleft").addClass("disableRL")):void(parseInt(d)>20-c?($(b).find(".pleft").addClass("disableRL"),$(b).find(".pright").removeClass("disableRL")):parseInt(d)<(e-2)*-c?($(b).find(".pleft").removeClass("disableRL"),$(b).find(".pright").addClass("disableRL")):($(b).find(".pright").removeClass("disableRL"),$(b).find(".pleft").removeClass("disableRL")))},this.skinBoxLRCheck=function(a,b){this.skinBoxLRCommon()},this.changeGameMode=function(a){var b=(""+a).trim().toUpperCase().replace(/ /g,"_");o=n,n=b,d?(this.setLoc(n),d.send("c.ed",{m:b,g:p})):c&&(this.setLoc(n),c.send("c.ed",{m:b,g:p}))},this.changeGraphics=function(a){var b=(""+a).toUpperCase().replace(/ /g,"_");q=p,p=b,d?d.send("c.ed",{m:n,g:b}):c&&c.send("c.ed",{m:n,g:b})},this.changeBackSkin=function(a){},this.openShop=function(){},this.isValidTauntResponse=function(a){var b=Conf.Taunt_CB_VALID;if(a===Conf.SUCCESS)return!0;for(var c=0;c<b.length;c++)if(b[c]===""+a)return!1;return!0},this.addTaunt=function(a,b){j.addTaunt(a,function(a){b(a)})},this.clearTauntCB=function(a){},this.removeTaunt=function(a,b,c){j.removeTaunt(a,b,c),"online"===c&&this.rqServ().removeTag(this.pname,this.uid,a)},this.clearTaunts=function(){this.gameSparkServer.clearTaunts($this.clearTauntCB)},this.clearTauntsLocal=function(){j.clearTauntsLocal()},this.toggleTaunt_server=function(a,b,c){j.toggleTaunt(a,b,c)},this.setToken=function(a){this.xtoken=a,window.initStoreWindow(this.xtoken.token)},this.addTauntTemplates=function(a){var b={tags:[]},c=Conf.TAUNT_STATUS,d=a||"",e=a||"",f=Soulcrashers.Templates.taunt,g=[];if(""===d)d=j.getLocalTaunts();else{g=j.getLocalTaunts(),d=[];for(var h=0;h<g.length;h++){var i=g[h],k="tag"+(h+1),l=i.status.toLowerCase();d.push({name:i.name,status:l})}for(var h=0;h<e.length;h++){var i=e[h],k="tag"+(h+1),l=i.status.toLowerCase();d.push({name:i.name,status:l}),j.addIfNotPresent_browser(e)}}for(var h=0;h<d.length;h++){var i=d[h],k="tag"+(h+1),l=i.status.toLowerCase();b.tags.push({name:i.name,tagno:k,tagstate:l,bcolor:c[""+l],color:c[""+l]})}b.tags.length>0?($(".taunts-scroll").html('<span class= "moretaunts"> <i class="glyphicon glyphicon-triangle-bottom"></i></span>'),$(".taunts-scroll").append(f(b))):$(".taunts-scroll").html(' <span class="empty-taunts">No Taunts Found</span>'),$(".mm-taunt-btn").off("click").on("click",function(){var a={},b=Conf.TAUNT_TOGGLE,c=Conf.TAUNT_TOGGLE_CLR;return function(){var d=$(this).data("taunt"),e=$(this).children(".mm-btn").text().trim();a[""+d]=""+b[""+e],$(this).css("background-color",Conf.TAUNT_STATUS[""+b[""+e]]).css("border","2px solid"+c[""+e]).children(".mm-btn").text(b[""+e]);var f=$(this).parent(".tau-div").children("span.taunt-txt").text();f&&f.length>0&&($(".user-taunts .taunts-header i.tstatus").css("color","yellow"),$this.toggleTaunt_server(f,b[""+e],function(a){}))}}()),$(".delTaunt").off("click").on("click",function(){$("#newtaunt").val(""),$(this).hide()});var m=.35*$(document).width();$(".delTaunt").css("left",.95*m+"px");var n=$(".taunts-scroll").height(),o=0;$(".taunts-scroll").children().each(function(){o+=$(this).outerHeight(!0)}),o-=$(".moretaunts").outerHeight(!0),o-n<1&&$(".moretaunts").fadeOut(),$(".taunt-txt i").off("click").on("click",function(){var a=$(this).parent(".taunt-txt").text()||"",b=$(this).closest(".tau-div").find("span.mm-btn").text().trim();a.length>0&&(a=a.trim()),$this.online?$this.showTauntDelPopUp(a,b,"online"):$this.showTauntDelPopUp(a,b,"local")}),$(".moretaunts").off("click").on("click",function(){var a=($(".taunts-scroll").height(),0);$(".taunts-scroll").children().each(function(){a+=$(this).outerHeight(!0)}),a-=$(".moretaunts").outerHeight(!0),$(".moretaunts").fadeOut()})},this.showTauntDelPopUp=function(a,b,c){$("#tauntlocaldialog").show(),$("#taunt-dialog-dno").off("click").on("click",function(){$("#tauntlocaldialog").hide()}),$("#taunt-dialog-dyes").off("click").on("click",function(){$this.removeTaunt(a,b,c),$this.addTauntTemplates(),$("#tauntlocaldialog").hide()})},this.addTauntDialogEvents=function(){$("#taunt-link").off("click").on("click",function(){$("#tauntadd").show(),$("#newtaunt").focus().val(""),$(".delTaunt").hide()}),$(".taunts-scroll").scroll(function(){var a=$(this).scrollTop(),b=$(this).height(),c=0;$(this).children().each(function(){c+=$(this).outerHeight(!0)}),c-=$(".moretaunts").outerHeight(!0);var d=c-b;a*=100/Math.max(1,d),a=Math.min(100,Math.max(0,a)),a<95?$(".moretaunts").fadeIn():$(".moretaunts").fadeOut()}),$("#taunt-box-add").off("click").on("click",function(){var a=$(this).siblings("#newtaunt").val();$this.addTaunt(a,function(a){a&&$this.isValidTauntResponse(a.trim())?($(".user-taunts .taunts-header i.tstatus").css("color","yellow"),$this.addTauntTemplates(),$("#tauntadd").hide()):($(".invalid-dialog-sm").text(""+a).show(),setTimeout(function(){$(".invalid-dialog-sm").fadeOut()},1e3))})}),$("#taunt-box-close").off("click").on("click",function(){$("#tauntadd").hide()}),$("#taunt-dialog-close").off("click").on("click",function(){$("#tauntdialog").hide()}),$("#taunt-dialogl-close").off("click").on("click",function(){$("#tauntlocaldialog").hide()}),$("#newtaunt").on("change paste keyup",function(){$(this).val().length<=0?$(".delTaunt").fadeOut("fast"):$(".delTaunt").fadeIn("fast")}),$("#newtaunt").off("keypress").on("keypress",function(a){var b=Conf.SplKeyCodes;if(a.which>=48&&a.which<=57||a.which>=65&&a.which<=90||a.which>=97&&a.which<=122)return!0;if(b.indexOf(a.which)>=0)return!0;if(13===a.which){var c=$(this).val();(""+c).length>1&&($this.addTaunt(c),$("#tauntadd").hide())}else a.preventDefault()})},this.addKeyUpEvent=function(){$(document).unbind("keyup"),$(document).off("keyup").on("keyup",function(a){27==a.keyCode&&$("#tauntadd").is(":visible")&&$("#tauntadd").hide(),13==a.keyCode&&($("#play-btn").is(":visible")?g?$this.addPlayerToGame($("#play-btn").text()):alert("please select a region first"):$("#soul-login-play").is(":visible")&&(g?$this.addPlayerToGame($("#soul-login-play").text()):alert("please select a region first")))})},this.setSkinTemplate=function(a){var b=[],c={avatartypes:[]},d=window.store,e=Conf.AVATAR_CLRS,f={alltabs:[],skcolor:[]},g=Soulcrashers.Templates["avatar-sel"],h=Soulcrashers.Templates.skinsli,i=[],j=Conf.SKIN_STATE_TEXT,k=Conf.SKIN_DETAILS,l=0;Conf.SHOP_ITEM_TYPES=[],a=a||"";var m={};if(""!==a){for(var n=a[0],o=Object.keys(n),p=0;p<e.length;p++)f.skcolor.push({skincolor:e[p]});for(var q=0;q<o.length;q++)Conf.SHOP_ITEM_TYPES.push(o[q].toLowerCase().substr(0,o[q].length-1)),c.avatartypes.push({type:""+o[q]}),f.alltabs.push({classname:"tab-"+o[q]+"-data",skinsul:[]});for(var p=0;p<o.length;p++)m[""+o[p]]=0,i.push({cname:o[p],c:Math.ceil(n[o[p]].length/3)});for(var q=0;q<o.length;q++)for(var r=""+o[q],s=0;s<n[r].length;s++){var t=n[r][s],u=a[3].types[t];b.push(t);var v,w,x=j.USE,y=Conf.SKIN_KEY_CLASS.USE,z=d.get(u+"."+t)||"";""!==z&&z===j.USE?(x=z.toUpperCase(),y=Conf.SKIN_KEY_CLASS[""+x]||Conf.SKIN_KEY_CLASS.USE):""!==z&&z===j.ACTIVE?m[""+o[q]]>=1?(d.set(u+"."+t,j.USE),x=j.USE,y=Conf.SKIN_KEY_CLASS.USE):(m[""+o[q]]++,x=z.toUpperCase(),y=Conf.SKIN_KEY_CLASS[""+x]||Conf.SKIN_KEY_CLASS.USE,this.activeShopElements[""+u.toLowerCase()]=t):d.set(u+"."+t,j.USE),"mask"==u?(l=Math.ceil(30/k[""+t].scale),v="eyes"+k[""+t].eyes,w="block",f.alltabs[Math.max(0,q)].skinsul.push({distype:w,imgsrc:"/images/skins/"+t+".png",imgeyes:"/images/skins/"+v+".png",imgeyes_s:l,tz:k[""+t].tz,lz:k[""+t].lz,skinbkcolor:"red",skinname:a[2][r][s][""+t],status:x,imgclassname:"mainimg",idname:t,obtype:u,imgcolorclass:"objmaskskin",skincolorclass:y})):(v="undefined",l=0,w="none",f.alltabs[Math.max(0,q)].skinsul.push({distype:w,imgsrc:"/images/skins/"+t+".png",imgeyes:"",imgeyes_s:"",skinbkcolor:"transparent",imgclassname:"genimg",tz:0,lz:0,skinname:a[2][r][s][""+t],status:x,idname:t,obtype:u,imgcolorclass:"objgenskin",skincolorclass:y}))}}return $(".tn-tabs").html(g(c)),$(".tn-tabs-c").html(h(f)),Conf.SKIN_FILES_SERV=b,i},this.showSkinDialogPage=function(){},this.resetSkinDialog=function(){},this.setSkinData=function(a){var b,c,d=this,e=!1,f=this.setSkinTemplate(a),g=$(".tn-tabs-c");if($(".ol-skins-main").is(":visible")){c=$(".tab-data").width(),$(".tn-tabs-c .friends_spinner").hide(),$(".tn-tabs").children(".skintabs").removeClass("tab-active"),$(".tn-tabs .tn-tab:first").addClass("tab-active"),b=$(".tn-tabs .tab-data:first").text().trim(),g.children(".tab-data:first").show().find("ul:first").css("margin-left","0px"),$(".ol-skins-main").show();for(var h=0;h<f.length;h++)g.children("."+f[h].cname).find("ul:first").width(f[h].c*c+10);$(".ol-skins-closebtn").off("click").on("click",function(){$(".ol-skins-main").hide()}),$(".tn-tabs").children(".skintabs").removeClass("tab-active"),$(".tn-tabs .tn-tab:first").addClass("tab-active"),b=$(".tn-tabs .tab-data:first").text().trim(),g.children(".tab-data").hide(),g.children(".tab-data:first").show(),d.skinBoxLRCheck(1,this)}$("#main_type").off("click"),JQ_click("main_type","#",function(a){a.stopPropagation(),c=$(".tab-data").width(),$(".tn-tabs-c .friends_spinner").hide(),$(".tn-tabs").children(".skintabs").removeClass("tab-active"),$(".tn-tabs .tn-tab:first").addClass("tab-active"),b=$(".tn-tabs .tab-data:first").text().trim(),g.children(".tab-data:first").show().find("ul:first").css("margin-left","0px"),$(".ol-skins-main").show();for(var e=0;e<f.length;e++)g.children("."+f[e].cname).find("ul:first").width(f[e].c*c+10);$(".ol-skins-closebtn").off("click"),$(".ol-skins-closebtn").on("click",function(){$(".ol-skins-main").hide()}),$(".tn-tabs").children(".skintabs").removeClass("tab-active"),$(".tn-tabs .tn-tab:first").addClass("tab-active"),b=$(".tn-tabs .tab-data:first").text().trim(),g.children(".tab-data").hide(),g.children(".tab-data:first").show(),d.skinBoxLRCheck(1,this)}),$(".tn-tabs-c span.left-right-c").off("click").on("click",function(){var a=this;c=$(this).parent(".tab-data").width(),"right"!=$(this).data("dir")||$(this).hasClass("disableRL")||e?"left"!=$(this).data("dir")||$(this).hasClass("disableRL")||e||(e=!0,$(this).siblings("ul").animate({marginLeft:"+="+Math.floor(c)+"px"},300,function(){e=!1,d.skinBoxLRCheck(3,a)})):(e=!0,$(this).siblings("ul").animate({marginLeft:"-="+Math.floor(c)+"px"},300,function(){e=!1,d.skinBoxLRCheck(3,a)}))}),$(".color-sel .sk-color").off("click").on("click",function(){var a=$(this).css("background-color");$(".tn-tabs-c img.mainimg").css("background-color",a),d.activeSkinColor=fMath.rgb2hex(a)}),$(".skintabs").off("click"),JQ_click("skintabs",".",function(){b=b||"";var a=$(this).text().trim();if(a!==b||""===b){$(this).toggleClass("tab-active"),$(this).siblings(this).removeClass("tab-active");var c=$(this).data("tab");"Masks"===c?$(".color-sel").show():$(".color-sel").fadeOut();var e=".tab-"+c+"-data";g.children(e).show().siblings(".tab-data").hide(),g.children(e).find("ul:first").css("margin-left","0px"),d.skinBoxLRCheck(2,this)}b=a}),$("#shop-link").off("click").on("click",function(){return $(".ol-shop-closebtn").off("click").on("click",function(){$(".ol-shop-main").hide()}),function(a){a.stopPropagation(),$(".ol-shop-main").show()}}()),$(".skin-buy-btn").off("click").on("click",function(){for(var a,b=d,c=Conf.SHOP_ITEM_TYPES||[],e=[],f=[],g={},h="",i=0;i<c.length;i++)a=$(".skinOnColor[data-type='"+c[i]+"']")||"",""!==a&&(h=a.data("name")||""),""!==h&&(e.push(a.data("name")),f.push(a)),g[""+c[i]]=i;return function(){var a=$(this).children("span").text().trim(),c="",d=$(this).data("name").trim(),h=$(this).data("type").trim(),i=(""+h).toLowerCase();a===Conf.SKIN_STATE_TEXT.USE||a===Conf.SKIN_STATE_TEXT.ACTIVE?(c=Conf.SKIN_STATES_TOGG[""+a]||"",window.store.set(h+"."+d,""+c),""!==e[g[""+h]]&&""!==f[g[""+h]]&&(window.store.set(h+"."+e[g[""+h]],""+Conf.SKIN_STATE_TEXT.USE),$(f[g[""+h]]).removeClass("skinOnColor").addClass("skinOffColor"),$(f[g[""+h]]).children("span").text(""+Conf.SKIN_STATE_TEXT.USE)),$(this).children("span").text(""+c),b.activeShopElements[""+i]=""+d,c===Conf.SKIN_STATE_TEXT.ACTIVE?$(this).removeClass("skinOffColor").addClass("skinOnColor"):c===Conf.SKIN_STATE_TEXT.USE&&$(this).removeClass("skinOnColor").addClass("skinOffColor")):($(this).children("span").text(Conf.SKIN_STATE_TEXT.ACTIVE),$(this).hasClass("skinOffColor")&&$(this).removeClass("skinOffColor").addClass("skinOnColor"),$(this).hasClass("skinOnColor")||$(this).addClass("skinOnColor")),e[g[""+h]]=d,f[g[""+h]]=this}}())},this.toggleSkinStateDialog=function(a){},this.addHomeTemplates=function(a){for(var b={cities:[]},c={symbols:[]},d={gamemodes:[]},e={gamemodes:[]},f={controls:[]},g={backskins:[]},h=[],i="",j=(Conf.CUST_NAME,Conf.GAME_CONTROLS),k=["himanshu","ash","nikhil","sy"],l=(""+Conf.DEF_MODE).trim(),m=this,n=Soulcrashers.Templates.citiestemp,o=Soulcrashers.Templates.gamemodes,p=Soulcrashers.Templates.controls,q=Soulcrashers.Templates.gamemodesmm,r=Soulcrashers.Templates.backskins,s=Soulcrashers.Templates.nicksymbol,t=Soulcrashers.Templates.shopcoins,u=[{itemcat:"popular",coinsValue:222,coinsPercent:30,coinsTotal:333,coinsPrice:55},{itemcat:"value",coinsValue:222,coinsPercent:30,coinsTotal:333,coinsPrice:"$55"},{itemcat:"none",coinsValue:222,coinsPercent:30,coinsTotal:333,coinsPrice:"$55"},{itemcat:"none",coinsValue:222,coinsPercent:30,coinsTotal:333,coinsPrice:"$55"}],v={packages:[]},w=0;w<u.length;w++)v.packages.push({itemcat:u[w].itemcat,coinsvalue:u[w].coinsValue,coinspercent:u[w].coinsPercent,coinstotal:u[w].coinsTotal,coinsprice:u[w].coinsPrice});for(var w=1;w<=7;w++){i+=(""+Conf["RAWSTR_"+w]).trim()}this.addTauntTemplates(),this.addTauntDialogEvents();for(var x=0;x<i.length;x++)h.push(i.charAt(x));for(var y=0;y<a.g.length;y++){var z=(""+a.g[y]).replace(/_/g," ");d.gamemodes.push({mode:z}),e.gamemodes.push({mode:z})}for(var w=0;w<j.length;w++){var A=j[w].fn,B=j[w].key;f.controls.push({controlfn:A,controlkey:B})}this.updateTopPlayers(k);for(var w=0;w<a.cityData.length;w++)b.cities.push({cityName:a.cityData[w]});for(var w=0;w<h.length;w++)c.symbols.push({symbol:h[w]});$("#backskin-selector").html(r(g)),$(".ol-shop-lists").html(t(v)),$("#mode-selector").html(o(d)),$(".controln").html(p(f)),$(".mm-mode-outer").html(q(e)),$(".main-symbols").html(s(c)),$("#location-selector").html(n(b)),$(".mm-mode").off("click"),$(".setting-tip").off("click"),$(".skins-tip").off("click"),$(".buycoins").off("click").on("click",function(){window=window||"",""!==window&&(window.XPayStationWidget=window.XPayStationWidget||""),""!==window.XPayStationWidget&&window.XPayStationWidget.open()}),m.addKeyUpEvent.call(m),$(".skins-tip").on("click",function(){$(".skin-settings").slideToggle("fast")}),$(".setting-tip").on("click",function(){setTimeout(function(){$(".game-controls").hide()},200),$(".user-settings").slideToggle("fast")}),$(".mm-sett-controls").off("click").on("click",function(){var a=!1;return function(){!1===a?($(this).siblings(".game-controls").slideToggle("fast"),$(this).children(".chev-controls").removeClass("glyphicon-chevron-down").addClass("glyphicon-chevron-up")):($(this).siblings(".game-controls").slideToggle("fast"),$(this).children(".chev-controls").removeClass("glyphicon-chevron-up").addClass("glyphicon-chevron-down")),a=!a}}()),$(".control-form").on("keyup",function(a){for(var b={},c=0;c<Conf.GAME_CONTROLS.length;c++){var d=Conf.GAME_CONTROLS[c];d&&(b[""+d.key]=Conf.CTRLS[""+d.key])}return function(a){var c="",d=!0,e=(""+remKeyCode).trim(),f=a.which;e.length>0&&b[e]&&delete b[""+e],13===f&&a.preventDefault(),b[""+Conf.KEY_VAL[""+f]]?(d=!1,c=Conf.CTRLS_MSG.ALREADY):c=Conf.CTRLS_MSG.INVALID,f===parseInt(Conf.CTRLS.SPACE)&&d?($(this).val(Conf.CTRLS_NAMES.SPACE),b[Conf.CTRLS_NAMES.SPACE]=Conf.CTRLS[""+Conf.CTRLS_NAMES.SPACE]):f===parseInt(Conf.CTRLS.ALT)&&d?($(this).val(Conf.CTRLS_NAMES.ALT),b[Conf.CTRLS_NAMES.ALT]=Conf.CTRLS[""+Conf.CTRLS_NAMES.ALT]):f===parseInt(Conf.CTRLS.SHIFT)&&d?($(this).val(Conf.CTRLS_NAMES.SHIFT),b[Conf.CTRLS_NAMES.SHIFT]=Conf.CTRLS[""+Conf.CTRLS_NAMES.SHIFT]):f===parseInt(Conf.CTRLS.CTRL)&&d?($(this).val(Conf.CTRLS_NAMES.CTRL),b[Conf.CTRLS_NAMES.CTRL]=Conf.CTRLS[""+Conf.CTRLS_NAMES.CTRL]):f===parseInt(Conf.CTRLS.H)&&d?($(this).val(Conf.CTRLS_NAMES.H),b[Conf.CTRLS_NAMES.H]=Conf.CTRLS[""+Conf.CTRLS_NAMES.H]):f===parseInt(Conf.CTRLS.E)&&d?($(this).val(Conf.CTRLS_NAMES.E),b[Conf.CTRLS_NAMES.E]=Conf.CTRLS[""+Conf.CTRLS_NAMES.E]):($(this).val(""+c),$(this).addClass("bk-color-lightred")),$(this).blur()}}()),$(".control-form").on("focus",function(a){$(this).removeClass("bk-color-lightred  bk-color-red control-set"),remKeyCode=$(this).val(),$(this).val("")}),$(".control-form").on("blur",function(a){var b=(""+$(this).val()).trim();$(this).addClass("control-set"),""===b&&($(this).addClass("bk-color-red"),$(this).val("INVALID"))}),$(".mm-mode-outer").children().each(function(a,b){$(b).text().trim()==l&&(m.lastMode_element=b,$(b).addClass("mm-mode-active"))}),JQ_click("mm-mode",".",function(){m.curMode_element=this;var a=$(this).text().trim();m.curMode_element!==m.lastMode_element&&(m.changeGameMode(a),null!==m.lastMode_element&&$(m.lastMode_element).removeClass("mm-mode-active"),$(this).addClass("mm-mode-active")),setTimeout(function(){$(".mm-mode-outer").slideToggle("fast")},150),m.lastMode_element=this}),$("#mode-selector").on("change",function(a){var b=this.options[a.target.selectedIndex].text.trim();m.changeGameMode(b),$("#mode-selector").blur()}),$("#quality-selector").on("change",function(a){var b=this.options[a.target.selectedIndex].text.trim();m.changeGraphics(b),$("#quality-selector").blur()}),JQ_click("backskin-selector","#",function(a){var b=this.options[a.target.selectedIndex].text.trim();m.changeBackSkin(b)}),$(".signinpanel-inner i").on("click",function(){var a=$(".main-symbols");"none"==a.css("display")?($(this).removeClass("glyphicon glyphicon-chevron-down").addClass("glyphicon glyphicon-chevron-up"),a.css("display","block")):($(this).removeClass("glyphicon glyphicon-chevron-up").addClass("glyphicon glyphicon-chevron-down"),a.hide())}),$(".main-symbols").on("click",function(a){a.stopPropagation()}),$(".spsym").on("click",function(){var a=$("#email");a.val().length<12&&a.val(a.val()+$(this).val())})},this.addRoomData=function(a){var b=$(".cityoptions"),c="";$.each(b,function(b,d){c=$(d).text(),a[c]=a[c]||"",""!==a[c]&&a[c]>=0&&$(d).text(c+" ("+a[c]+")")})},this.getCurrMode=function(){return n},this.getCurrQua=function(){return p},this.bpRec=function(a,b){var c=this,d=[],e={};a=(""+a).trim().split(",");for(var f=0;f<a.length;f++)pushArr(d,(""+a[f]).toUpperCase().trim().replace(/_/g," "));social=new Social(c),social.init(),this.addJQEvents(c),j=new Taunts(c),e={cityData:a,g:d},c.addHomeTemplates(e),c.addJQEvents_handlebars(),b&&c.addRoomData(b),c.addUITimer(),canvas.width,canvas.height},this.clientLo=function(){},this.req1data=function(a){},this.gLogin=function(a){social.gLogin(a)},this.basicSetup=function(){var a=this;c=Primus.connect(CONN_STR,{reconnect:{max:1/0,min:500,retries:10}}),c.on("s.conn",function(){!0===m?c.send("c.cnn",1):c.send("c.cnn",2)}),c.on(S_RU,function(b){b.citySizes&&a.addRoomData(b.citySizes)}),c.on(S_OPEN,function(){a.rqServ().sendReq_tags(),$("#soul-connection").hide();var b=a.getCurrMode;c.send("basesetup",{m:b}),c.on("incoming::ping",function(b){a.latency=Date.now()-b}),c.on("s.store",function(b){a.setToken(b)}),c.on(S_BP,function(b){var c=(""+LZStr.decompressFromBase64(b)).split("^");appClient.setConfFiles(c),appClient.setFiles(c[4],c[5],c[2].split(","),c[6],c[7]),appClient.init(a.bpRec.bind(a,c[0],c[1].split("_"))),appClient.setSkinData(JSON.parse(c[16]))}),c.on(S_MT,function(){alert("GAME UNDER MAINTAINENCE. TRY AGAIN LATER.")})})},this.setLoc=function(a){if(a=a||"",""!==(a=(""+a).toLowerCase().trim()))if(l!==a&&""!==l)d.send("c.nreg",{newreg:a});else{d=c.channel(""+a),l.length<=1&&(l=a),this.skinner=new Skinner,this.skinner.init(d),this.addSocketEvents();var b=this.getCurrMode(),e=this.getCurrQua();d.send("c.ed",{m:b,g:e})}},this.playerDead=function(){m=!1;for(var a=window.setTimeout(function(){},0);a--;)window.clearTimeout(a);this.resetGame(function(){}),i.resetBlockDots(),this.setLoc(n);var b=this;setTimeout(function(){b.showInt()},3e3)},this.resetGame=function(a){this.otherPlayers=[],this.discData=[],
this.otherPlayersKeys=[],this.addUITimer(),$("#soul-login-play").text("Play again"),$("#play-btn").text("Play again as Guest"),player.clearData(a),e.onRender=function(a){},e.onUpdate=function(a){}},this.initClient=function(){null!==e&&(ctx=i.ctx,k&&k.removeEvents(),k=new Keys(Math.abs(window.outerHeight-window.innerHeight)),player=new Player(Conf.MAX_SCALE_PLAYER,parseInt(999999*Math.random(),10),window.innerWidth/2,window.innerHeight/2,10,null,null,k,i,!0),i.setCamera(player),i.setBar(),this.gameUpdate(e,player),this.gameRender(e,player,i,ctx),d.send("c.rd"))},this.addOtherPlayer=function(a,b){a.otherPlayers[""+b]=new Player(Conf.MAX_SCALE_PLAYER,b,window.innerWidth/2,window.innerHeight/2,10,null,null,null,a.getRenderer())},this.getRenderer=function(){return i},this.gkeyboard=function(){return k},this.getGame=function(){return e},this.showWelcomeScreen=function(){"none"!=$("#canvas").css("display")&&this.reset()},this.roomSet=function(){this.gd_load=!0,f=CURR_REND.GAME,this.getGame().startGameLocal(),d.send("c.rfd")},this.remUP=function(){},this.addUP_T=function(){d.on(C_UP,function(a){})},this.addUP_D=function(){},this.addUP_M=function(){},this.getPlayer=function(){return player},this.addUP_E=function(){var a=0,b="",c=[],e="",f=[],g=[],h=0,j=0;d.on(C_UP,function(d){g=LZStr.decompressFromBase64(""+d).split("^"),j=Number(g[5]),c=[],e="",f=[],b=g[2]||"",b.length;var k,l,m,n,o=g[7].split("_"),p=g[3],q=0,r="",s=o.length-1,t=g[0]||"",u=g[1]||"",v="";if(""!==t)for(t=t.split("*"),h=mmax(0,t.length-1),q=0;q<t.length;q++)v=t[q],player.id===v?player.rotate():$this.otherPlayers[""+v]&&$this.otherPlayers[""+v].rotate();if(""!==u)for(u=u.split("*"),h=mmax(0,u.length-1),q=0;q<h;q++)v=u[q],player.id===v?player.rotateOff():$this.otherPlayers[""+v]&&$this.otherPlayers[""+v].rotateOff();if(p.length>0){var w=p.split("`");for(q=0,H=w.length-1;q<H;q++)m=w[q].split("@"),n=m[1].split("_"),$this.otherPlayers[m[0]].shootBullet(n)}for(s>0&&i.flushShootBar(),q=0;q<s;q++)n=o[q],player.shootBullet(n);for(r=(""+g[6]).split("*"),q=0,H=r.length-1;q<H;q++)if(item=r[q],"g"===item.charAt(0))c.push(item);else if("q"===item.charAt(0))if(e=item.slice(1),player.id===e)player.underAttack();else{var x=$this.otherPlayers[""+e]||"";""!==x&&x.underAttack()}else if("d"===item.charAt(0))f.push(item);else if("b"===item.charAt(0)){var y=item.slice(1).split("_"),z=y[0].split("."),A=$this.otherPlayers[z[0]]||player;$this.otherPlayers[z[1]];A.removeBulletHit(y[1])}for(k=kkeys($this.otherPlayers),q=0;q<k.length;q++)$this.otherPlayers[k[q]].hideDataWise();var B=(""+g[8]).split("_"),C=B[0].split("*");for(a=Number(g[4]),player.pushStates(C,j,a,!0),chartdata.push({x:++tttt,y:j}),q=1,H=B.length-1;q<H;q++){var D=B[q].split("*");l=$this.otherPlayers[""+D[0]],l&&l.pushStates(D,j,a,!0)}for(q=0;q<k.length;q++)$this.otherPlayers[k[q]].hideShow();if($this.getRenderer().gridChangeServ(c,f,$this.otherPlayers,player),b.length>0)for(var E=b.split("*"),F="",G="",H=mmax(0,E.length-1),q=0;q<H;q++){F=E[q].split("_"),id=F[0],G=F[1];var I=$this.otherPlayers[""+id]||"";""!==I&&I.dead&&(pushArr($this.discData,{pid:id,r:G}),$this.getRenderer().resetDeadSprites(I))}})},this.setInitClrs=function(a,b){for(var c=[],d=a.split("."),e={},f=0;f<d.length-1;f+=2)c.push(d[f]),e[""+d[f]]=d[f+1];for(var g=0;g<c.length;g++){var h=$this.otherPlayers[""+c[g]]||"";""!==h&&($this.getRenderer().baseColorSet(h,e[""+c[g]],b),h.setBaseSprites(e[""+c[g]]))}},this.createLB=function(){lb=void 0,lb=new Leaderboard(i,$this.cur_m_str)},this.addSocketEvents=function(){var a=this;d.on(S_SMC,function(b){C_UP=""+Conf.CUP[b.m]+(""+b.r).trim(),o=o||"",""!==o&&d.off(o),b.m===Conf.MODE_NAMES.TEAM_BATTLE?a.addUP_T.bind(a)():b.m===Conf.MODE_NAMES.DOMINATION?a.addUP_D.bind(a)():b.m===Conf.MODE_NAMES.KNT?a.addUP_E.bind(a)():b.m===Conf.MODE_NAMES.MONSTER&&a.addUP_M.bind(a)();var c=b.q||"";""!==c&&(p=(""+c).trim())}),d.on(S_ERR,function(a){}),d.on("dead",function(){a.playerDead()}),d.on(S_WDD,function(c){var e=a.getRenderer(),f=LZStr.decompressFromBase64(c.toString());f=f.split("*");for(var g=-1,h="",i=0;i<f.length;i++)h=f[i],g=h.substr(0,40).split(",")[0].split("_")[2],h.length>1&&e.setWorldDotsDataForABlock_start(h,g);a.hideInt(),k.setMouseEvents(a.mouseScroll),b.bind(a)(),d.send("c.coll")}),d.on(S_WDT,function(b){var c=b.ti;a.getRenderer().setWorldTileData(c)}),d.on("s.wd",function(b){var c=b.ct||Date.now(),e=LZStr.decompressFromBase64(b.sclr);player.id=d.id,player.setPos(b.p),n==Conf.MODE_NAMES.DOMINATION?a.getRenderer().DOM_initServer(b.rr,b.td):n==Conf.MODE_NAMES.KNT&&a.getRenderer().initServer(b.rr),a.getRenderer().setGridMain(a.roomSet.bind(a),a.setInitClrs.bind(a,e,c),a.restart)}),d.on("s.rdy",function(b){a.initClient(),player.setColor_skin_name(b.cl.c,b.cl.n,{n:a.activeShopElements.mask,c:a.activeSkinColor}),player.update_eye_fn(),a.createLB(),a.cleanMem()}),d.on("s.msdto",function(b){if(""!==(b=b||"")){a.addOtherPlayer(a,b.sockid);var c=a.otherPlayers[b.sockid]||"";""!==c&&c.setColor_skin_name(b.cl.c,b.cl.n,b.cl.sk)}}),d.on("s.opsd",function(b){for(var c=0;c<b.cls.length;c++){var d=b.cls[c];a.addOtherPlayer(a,d.id),a.otherPlayers[""+d.id].setColor_skin_name(d.clr,d.nm,d.sk)}}),d.on("otherplayerremoved",function(a){a=a||""}),d.on("playeradded",function(b){b.pSize&&b.pSize>0&&(a.playerOn=!0)}),d.on(S_RU,function(b){b.citySizes&&a.addRoomData(b.citySizes)}),d.on("connected",function(){var b=(a.getRenderer().getCanvasData(),{x:canvas.width,y:canvas.height});d.send("c.wr",b),socket=null,g=!0}),d.on("regionleft",function(b){l=b.newreg||"",g=!1,""!==b.newreg&&(a.socketModified=!0,d.end(),d=c.channel(""+l),a.addSocketEvents(),a.socketModified=!1)}),d.on("disconnected",function(){}),d.on("disconnect",function(){}),d.on("online",function(){}),d.on("end",function(){}),d.on("close",function(){}),d.on("offline",function(){}),d.on("heartbeat",function(){})},this.addPlayerToGame=function(a){a=(""+a).toLowerCase();var b=(""+a).indexOf("again"),c="",f={};if(b>=0&&(this.restart=!0),null!==e){var g=window.store.get("prevroom"),h=$("#email").val();h=h.replace(/[^\x00-\x7F]/g,"");var i=0;h=(""+h).substr(0,Conf.MAX_NAME_LEN);for(var j=h.length-1;j>=0&&" "===h.charAt(j);j--)i++;h=h.substr(0,h.length-i),h.length<=0&&(h=Conf.UNTITLED_NAME),c=this.activeShopElements.mask,f={a:c,c:this.activeSkinColor},e.setSocketAndAdd(d,g,h,f)}},this.gameRender=function(a,b,c,d){a.onRender=function(a){b&&c.renderWorld(b,this.otherPlayers,a)}.bind(this)},this.worldUpdate=function(a){},this.gameUpdate=function(a,b){var c,d=this,e=0;a.onUpdate=function(a){for(b&&b.update(a),c=kkeys(d.otherPlayers),e=0;e<c.length;e++)d.otherPlayers[c[e]].update(a)}},this.setUniqueId=function(){Math.random().toString(36).substring(3,16),new Date;window.store.set("gameUniqueId",a())},this.addJQEvents_handlebars=function(){var a=n;$this=this,$this.setLoc(a),$("#btn-fb-glo").off("click").on("click",function(){social.fbBtnClicked()}),JQ_click("areas-outer ul li",".",function(b){if(null===a||void 0===a);else if(a!=this){self=$(this);$(a)}})},this.mouseScroll=function(a){return!1},this.getServer=function(){return this.gameSparkServer},this.filesLoaded=function(a){e=new Game(FPS,i),a()},this.setConfFiles=function(a){Conf.MAX_SCALE_PLAYER=Number(a[9]),Conf.MOUSE_CLICK_POLL_TIME=Number(a[10]),Conf.CUP_CONST=a[11],Conf.START_RAD=Number(a[13]),Conf.RAD_MASS_R=Number(a[14]),Conf.DEL_SCALE_EAT=Number(a[15]);for(var b=(""+a[12]).split(","),c=0;c<b.length;c++);Conf.DEF_MODE=a[8];var d=a[0]||"",e=(""+d).split(","),f=[];Conf.MODES=[],Conf.CUP={},Conf.MODE_NAMES={},Conf.GAME_MODES={};for(var c=0;c<e.length;c++){var g=(""+e[c]).toUpperCase().trim();Conf.MODE_NAMES[g]=g,Conf.CUP[g]=(a[11]+"."+b[c]).trim(),Conf.GAME_MODES[g]=Number(c+1),f.push(g)}Conf.MODES=f,n=Conf.DEF_MODE,o=n},this.setFiles=function(a,b,c,d,e){var f,g=c.length||"",h=[],i="",j="",k=[],l={},m=-1;if(""!==g&&g>0)for(var n=0;n<g;n++){if(k=(""+c[n]).split("_"),f=(""+k[1]).slice(1),m=(""+k[1]).indexOf("s")>=0,k.length>1&&m){if(j=k[0],(""+k[1]).length>1){var o=f.split(".")[1].split("@")||[55,7];l[""+j]={eyes:f.charAt(0),scale:f.charAt(1),lz:o[0],tz:o[1]}}i="skins/"}else j=c[n];h[n]=a+"/"+i+j+"."+d,(""+j).indexOf("dot")>=0&&4===j.length&&(Conf.DOT_FILES.push(a+"/"+j+"."+d),Conf.DOT_CLRS[a+"/"+j+"."+d]=e[(""+j).charAt(j.length-1)]),Conf.FILESI[""+j]=parseInt(n)}Conf.FILES=h.slice(),Conf.SKIN_DETAILS=l},this.tauntExpand=function(){},this.updateTips=function(){var a=0,b=this,c=b.getTips().length;return function(){var d=a++%c,e=b.getTips()[d];$(".helpingsoul").animate({opacity:0},TIP_INTERVAL,function(){$(this).text(e),$(".helpingsoul").animate({opacity:1},TIP_INTERVAL,function(){})})}},this.serverError=function(a){if("gs"===a){var b={};b.issue="Cannot connect to server. Try again later.",b.gly1="glyphicon-globe",b.gly2="glyphicon-alert",b.heading="ALERT";var c=Soulcrashers.Templates.blank;$("#blackoverlay").html("").html(c(b))}},this.loginSucc=function(a,b){this.loginType=a,this.logoutText(),$(".mm-log-btn").show(),$(".secrow").hide(),$(".secrow-logged").show(),"fb"===a?($(".user-heading").text(b.name_),$(".user-header-in img").attr("src",b.url_),$(".user-header-in span.user-heading").prop("title",b.name_),$(".ol-signup-main").hide()):"goo"===a&&($(".user-heading").text(b.name_),$(".user-header-in img").attr("src",b.url_),$(".user-header-in span.user-heading").prop("title",b.name_),$(".ol-signup-main").hide())},this.rqServ=function(){return this.reqServer},this.init=function(a){var b=this;h=["1","2","3"],randTime=1e3*(TIP_RAND_START+parseInt(Math.random()*TIP_RAND_DEL)),setTimeout(function(){b.tiploop=setInterval(b.updateTips(),1e3*TIP_DELTA),r.push(b.tiploop)},randTime),i=new Renderer(b),i.setupRenderer(this.filesLoaded.bind(this,a))},this.kill=function(){},this.reset=function(){$this=this,$("#canvas").hide(),$("#footer").show(),$("#soulbox").fadeIn("1000"),this.addUITimer()}},appClient=new AppClient;appClient.basicSetup(),window.initStoreWindow=function(a){null!==a&&void 0!==a||alert("token not defined");var b={access_token:a,sandbox:!0},c=document.createElement("script");c.type="text/javascript",c.async=!0,c.src="https://static.xsolla.com/embed/paystation/1.0.7/widget.min.js",c.addEventListener("load",function(a){XPayStationWidget.init(b),XPayStationWidget.on("close",function(a){void 0===window&&null===window||window.clientStoreClosed(a)}),XPayStationWidget.on("load",function(a){void 0===window&&null===window||window.clientStoreLoaded(a)})},!1),document.getElementsByTagName("head")[0].appendChild(c)}.bind(window),window.captCallback=function(a){appClient.verf_capt(!0,function(){grecaptcha.reset()})},window.captECallback=function(a){appClient.verf_capt(!1)},window.check_username_inp=function(a){void 0!==document.getElementById("usernametaken")&&$("#usernametaken").remove()}.bind(window),function(){if(Date.now||(Date.now=function(){return(new Date).getTime()}),"performance"in window==0&&(window.performance={}),Date.now=Date.now||function(){return(new Date).getTime()},"now"in window.performance==0){var a=Date.now();performance.timing&&performance.timing.navigationStart&&(a=performance.timing.navigationStart),window.performance.now=function(){return Date.now()-a}}}();var pushArr=function(a,b){a[a.length]=b},spliceOne=function(a,b){var c=a.length;if(c){for(;b<c;)a[b]=a[b+1],b++;a.length--}},indexOf=function(a,b){for(var c=0,d=a.length;c!=d;c++)if(a[c]===b)return c;return-1},$=require("jquery"),Camera=require("./camera.js"),jQuery=$,FastMath=require("./fastmath.js"),fMath=new FastMath,Conf=require("./gameConf.js"),extraFilter=require("pixi-extra-filters"),Eye_color={},NO_OF_WBLOCKS=0,TextureCache=PIXI.utils.TextureCache,Texture=PIXI.Texture,BaseTexture=PIXI.BaseTexture,Container=PIXI.Container,Rectangle=PIXI.Rectangle,autoDetectRenderer=PIXI.autoDetectRenderer,loader=PIXI.loader,Sprite=PIXI.Sprite,Resources=PIXI.loader.resources,Graphics=PIXI.Graphics,Tex_fromImage=PIXI.Texture.fromImage,targetWidth=1920,targetHeight=1080,CURR_REND={NONE:0,WORLD:1,GAME:2},mmax=Math.max,mmin=Math.min,DO_SC=Conf.DO_SC,DO_A=Conf.DO_A,DO_SP=Conf.DO_SP,MAX_AL=1,BO_SC=Conf.BO_SC,BO_CL=Conf.BO_CL,BO_A=Conf.BO_A,BO_LW=Conf.BO_LW,BO_SZ=Conf.BO_SZ,SHOOT_FILL_SZ=Conf.SHOOT_REFILL_SIZE,BO_LC=Conf.BO_LC,BO_LA=Conf.BO_LA,C_YELLOW=Conf.T_COLORS.YELLOW,C_GREEN=Conf.T_COLORS.GREEN,C_RED=Conf.T_COLORS.RED,C_BLUE=Conf.T_COLORS.BLUE,DEF_COL=Conf.GRID_SPR_BASE_CLR,DOTS_TEX=Conf.DOT_FILES,COLOR_NUM=Conf.DOT_CLRS,GRID_RECT_SPRITE_P_BLOCK,ShootBar=function(a,b){this.width=SHOOT_FILL_SZ,this.height=SHOOT_FILL_SZ/4,this.x=a,this.y=b,this.count=0,this.graphics=void 0,this.base=void 0,this.container=new Container,this.reset=function(){var a=this,b=0,c=a.graphics,d=parseInt((Conf.MOUSE_CLICK_POLL_TIME-30)/40),e=setInterval(function(){b++,b>=40&&(c.scale.x=2,clearInterval(e)),c.scale.x=Math.min(2,c.scale.x+.05)},d)},this.flush=function(){var a=this,b=0,c=a.graphics,d=setInterval(function(){b++,b>=2&&(c.scale.x=.04,clearInterval(d),a.reset()),c.scale.x=Math.max(0,c.scale.x-.1)},16)},this.set=function(a,b){var c=Resources[Conf.FILES[Conf.FILESI.healthbar]].texture,d=new Sprite(c);d.tint=16711680;var e=new Sprite(c);e.tint=65280,d.anchor.x=e.anchor.x=0,d.anchor.y=e.anchor.y=.5,d.scale.x=d.scale.y=1,e.scale.y=1,e.scale.x=d.scale.x=2,e.x=d.x=this.x-this.width,e.y=d.y=this.y,d.displayGroup=e.displayGroup=b,this.container.addChild(d),this.container.addChild(e),this.graphics=e,a.addChild(this.container)}},WorldBoundary=function(a,b,c,d){this.width=c,this.height=d,this.x=a,this.y=b,this.count=0,this.graphics=void 0,this.lines=void 0,this.container=new Container};WorldBoundary.prototype.update=function(a){this.count+=a;var b=this.count;this.lines.alpha=.2*fMath.sin(b)+.7,this.lines.scale.x=1+fMath.sin(b)*BO_SC,this.lines.scale.y=1+fMath.cos(b)*BO_SC},WorldBoundary.prototype.setBoundary=function(a,b){var c=new Graphics,d=new Graphics,e=BO_SZ;c.beginFill(BO_CL,BO_A),c.drawRect(this.x-e,this.y-e,this.width+e,e),c.drawRect(this.x+this.width,this.y-e,e,this.height+2*e),c.drawRect(this.x-e,this.y-e,e,this.height+e),c.drawRect(this.x-e,this.y+this.height,this.width+e,e),c.displayGroup=b,c.endFill(),d.lineStyle(10,16720384,.7),d.drawRect(this.x,this.y,this.width,1),d.drawRect(this.x+this.width,this.y,1,this.height),d.drawRect(this.x,this.y,1,this.height),d.drawRect(this.x,this.y+this.height,this.width,1),d.endFill(),this.container.addChild(c),this.container.addChild(d),a.addChild(this.container),this.graphics=c,this.lines=d};var WorldGridBlock=function(a,b,c,d,e){this.startX=a,this.blockno=e,this.row=d,this.startY=b,this.dim=c,this.container=new Container,this.container.pivot.x=.5,this.container.pivot.y=.5,this.gridSprites=[],this.gridDots=[],this.added=!1,this.onDotsCount=0,this.onDotsIds=[],this.onSpriteCount=0};WorldGridBlock.prototype.resetDots=function(){this.onDotsIds=[];for(var a=0,b=this.gridDots.length;a<b;a++)this.gridDots[a].disable()},WorldGridBlock.prototype.innerCheck=function(a,b){return-1},WorldGridBlock.prototype.resetGroundSprites=function(a){for(var b=this.gridSprites,c=0;c<b.length;c++)if(b[c].id===a){b[c].fastReset();break}},WorldGridBlock.prototype.stepOnGrid=function(a,b,c){for(var d=this.gridSprites,e=a,f=d.length,g=-1,h=0;h<f;h++)if(d[h].id===e){g=h;break}return g>=0?d[g].setTint(b,.6,c):""},WorldGridBlock.prototype.setStartGridClrs=function(a,b){for(var c=this.gridSprites,d=c.length,e=-1,f=0;f<d;f++)if(c[f].id===a){e=f;break}e>=0&&c[e].setTintBasic_start(b,.6)},WorldGridBlock.prototype.hideDotFromServ=function(a,b,c){var d=this.gridDots,e=d.length,f=-1,g=0;for(g=0;g<e;g++)if(d[g].id===a){f=g;break}f>=0&&d[f].collision(b,c)},WorldGridBlock.prototype.update=function(a,b,c){for(var d,e=this.gridDots,f=e.length,g=Math.abs,h=c[0]/2,i=c[1]/2,j=0;j<f;j++)d=e[j].sprite,g(b.x-d.x)<=h&&g(b.y-d.y)<=i?e[j].update(a):e[j].disableDAni()},WorldGridBlock.prototype.isVisible=function(){return this.container.visible},WorldGridBlock.prototype.addToOnDots=function(a){for(var b=this.onDotsIds,c=0,d=a.length;c<d;c++){var e=a[c][3];b.indexOf(e)<0&&pushArr(b,e)}},WorldGridBlock.prototype.addToOnDotsStart=function(a){for(var b=this.onDotsIds,c=this.gridDots,d=a.length,e=0;e<d;e++)c[e].onFromServ(a[e]),pushArr(b,a[e])},WorldGridBlock.prototype.setDots=function(a,b){for(var c=this.container,d=this.gridSprites.length,e=0,f=0;f<d;f+=1){var g=fMath.getRandomIntInclusive(0,4),h=Resources[""+DOTS_TEX[g]].texture;sprite=new Sprite(h),sprite.scale.x=1,sprite.scale.y=1,sprite.anchor.x=.5,sprite.anchor.y=.5,sprite.y=0,sprite.x=0,e++,pushArr(this.gridDots,new GridDot(sprite,COLOR_NUM[DOTS_TEX[g]])),sprite.displayGroup=b,c.addChild(sprite),sprite.visible=!1}},WorldGridBlock.prototype.remFromOnDots=function(a){for(var b=this.onDotsIds,c=0,d=a.length;c<d;c++){var e=a[c][3],f=b.indexOf(e);f>=0&&b.splice(f,1)}},WorldGridBlock.prototype.getSize=function(){return this.dim},WorldGridBlock.prototype.getStartX=function(){return this.startX},WorldGridBlock.prototype.getStartY=function(){return this.startY},WorldGridBlock.prototype.setBlocks=function(a,b,c,d){for(var e=GRID_RECT_SPRITE_P_BLOCK,f=(this.dim-e*d)/e,g=this.startX,h=this.container,i=this.startY,j=0,k=0;k<e;k+=1)for(var l=0;l<e;l+=1)sprite=new Sprite(c),j++,sprite.scale.x=gridEleScale,sprite.scale.y=gridEleScale,sprite.y=i+Math.floor(f*(k+1)+k*d),sprite.x=g+Math.floor(f*(l+1)+l*d),pushArr(this.gridSprites,new GridSprite(sprite,sprite.x+"_"+sprite.y,this.blockno)),sprite.displayGroup=b,h.addChild(sprite);h.visible=!1,this.added||a.addChild(this.container)},WorldGridBlock.prototype.updateDotsData=function(a,b,c,d){for(var e=d.length,f=0;f<e;f++);},WorldGridBlock.prototype.show=function(){this.container.visible=!0},WorldGridBlock.prototype.hide=function(){this.container.visible=!1};var GridDot=function(a,b){this.count=0,this.sprite=a,this.color=b,this.enabled=!0,this.cb="",this.id="",this.time=-1,this.state=0,this.ed=0,this.factor=.03+.09*Math.random()};GridDot.prototype.collision=function(a,b){this.time=a[0],this.state=3,this.ed=fMath.fastAtan2(b.y-this.sprite.y,b.x-this.sprite.x),setTimeout(this.popped.bind(this,a),120)},GridDot.prototype.popped=function(a){this.enabled=!1,this.sprite.visible=!1,this.state=0,this.cb=setTimeout(this.on.bind(this,a[1],a[2]),this.time)},GridDot.prototype.on=function(a,b){var c=this;""!==this.cb&&clearTimeout(this.cb),this.factor=.03+.09*Math.random();var d=this.id.slice(0).split("_"),e=fMath.getRandomIntInclusive(0,4);this.color=COLOR_NUM[DOTS_TEX[e]];var f=this.sprite;f.texture=Resources[""+DOTS_TEX[e]].texture,f.scale.x=0,f.alpha=1,f.scale.y=0,f.x=parseInt(d[0]),f.y=parseInt(d[1]),f.x+=parseInt(a),f.y+=parseInt(b),this.enabled=!0,this.show(),this.state=1,setTimeout(function(){c.state=2},150)},GridDot.prototype.onFromServ=function(a){var b=a.split("_");this.sprite.x=parseInt(b[0]),this.sprite.y=parseInt(b[1]),this.id=a,this.show(),this.enabled=!0,this.state=2},GridDot.prototype.show=function(){this.sprite.visible=!0},GridDot.prototype.isVisible=function(){return this.sprite.visible},GridDot.prototype.disable=function(){this.sprite.visible=!1,this.count=0,this.enabled=!1,this.cb="",this.id="",this.time=-1,this.state=0,this.ed=0},GridDot.prototype.update=function(a){if(this.enabled){var b=this.state,c=this.sprite,d=0;c.visible||(c.visible=!0),3===b?(c.scale.x-=DO_SC,c.scale.y-=DO_SC,c.alpha-=DO_A,c.scale.x<=0&&(c.scale.x=0,c.scale.y=0),c.x+=fMath.cos(this.ed)*DO_SP,c.y+=fMath.sin(this.ed)*DO_SP):1===b?(c.scale.x+=.01,c.scale.y+=.01):2===b&&(this.count+=this.factor,d=this.count,c.x+=fMath.cos(d)*this.factor*2,c.y+=fMath.sin(d)*this.factor*2,c.scale.x=1+.05*fMath.sin(d),c.scale.y=1+.05*fMath.cos(d))}},GridDot.prototype.disableDAni=function(){this.sprite.visible=!1};var GridSprite=function(a,b,c){this.sprite=a,this.filled=!1,this.color="",this.id=b,this.owner="",this.bno=c,this.sprResetInt=[],this.cachedColor="",a.tint=DEF_COL,this.timerHandler=void 0};GridSprite.prototype.setOwner=function(a){this.owner},GridSprite.prototype.hex_rgb=function(a){var b=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a);return b?{r:parseInt(b[1],16),g:parseInt(b[2],16),b:parseInt(b[3],16)}:null},GridSprite.prototype.rgb_hex=function(a,b,c){var d=a<<16|b<<8|c;return function(a){return new Array(7-a.length).join("0")+a}(d.toString(16).toUpperCase())},GridSprite.prototype.fastReset=function(){this.sprite.tint="0x222222",this.owner=""},GridSprite.prototype.isPossessed=function(){return"0x222222"!==this.sprite.tint},GridSprite.prototype.isPossBySelf=function(a){return this.sprite.tint===a},GridSprite.prototype.setTintBasic_start=function(a,b){this.sprite.tint=""+a,b&&(this.sprite.alpha=b)},GridSprite.prototype.setTint=function(a,b,c){var d=a,e=this.sprite;return e.alpha=.4,e.tint=d,this.owner=c,e.alpha=b||1,e.filters=[new extraFilter.GlowFilter(3,1,1,d,.03)],setTimeout(function(){e.filters=[],e.alpha=.8},100),this.owner},GridSprite.prototype.getX=function(){return this.sprite.x},GridSprite.prototype.getY=function(){return this.sprite.y},GridSprite.prototype.getXY=function(){return{x:this.sprite.x,y:this.sprite.y}},GridSprite.prototype.getColor=function(){return this.color},GridSprite.prototype.isFilled=function(){return this.filled};var gridEleScale=0,gridEleSize=0,Renderer=function(a){var b,c,d,e,f,g,h,i=0,j=Conf.FILES,k=0,l=(CURR_REND.NONE,a),m=0,n=[],o=[],p=new PIXI.DisplayGroup(0,!1),q=new PIXI.DisplayGroup(7,!1);new PIXI.filters.BlurFilter;this.camera=null,this.lastPatt="",this.winWidth=0,this.winHeight=0,this.gridNames={},this.view=null,this.gridSet=!1,this.player=void 0,this.otherplayers=[],this.plNamesOnGrid=[],this.activeBlocks=[],this.playerColorTable={},this.getPlayerStage=function(){return f},this.setWorldDotsDataForABlock_start=function(a,b){var c=n[mmax(0,b-1)];a=a.split(","),c.addToOnDotsStart(a)},this.resetBlockDots=function(){for(var a=0;a<n.length;a++)n[a].resetDots()},this.pushPlNameOnGrid=function(a,b,c){},this.setWorldTileData=function(a){},this.changeBackgroundColor=function(a){b.backgroundColor=a},this.getClient=function(){return l},this.initServer=function(a){i=a.ws,NO_OF_WBLOCKS=a.nb,Conf.worldSize=i,GRID_RECT_SPRITE_P_BLOCK=a.qq,Conf.GRID_RECT_SPRITE_P_BLOCK=GRID_RECT_SPRITE_P_BLOCK,k=i/NO_OF_WBLOCKS,gridEleSize=a.ge_si,gridEleScale=a.ge_sc},this.getCanvasData=function(){var a=b.view;return{x:a.width,y:a.height}},this.winResize=function(){var a=mmax(600,window.innerWidth),c=mmax(window.innerHeight),d=b.view;return this.winWidth=a,this.winHeight=c,d.width=a*window.devicePixelRatio,d.height=c*window.devicePixelRatio,d.style.width=a+"px",d.style.height=c+"px",b&&(b.resize(d.width,d.height),this.camera&&this.camera.updateViewPort(d.width,d.height)),window.scrollTo(0,0),{x:d.width,y:d.height}},this.blurBackground=function(a){},this.updateSkinDetails=function(a){Eye_color=a},this.setupRenderer=function(a){b=new autoDetectRenderer(null,null,{backgroundColor:Conf.BACKGROUND_COLORS.NORMAL,antialias:!0}),this.view=b.view,document.body.appendChild(this.view),b.view.id="canvas",c=c||new Container,d=d||new Container,f=f||new Container,e=e||new Container,e.pivot.x=.5,e.pivot.y=.5,f.pivot.x=.5,f.pivot.y=.5,c.pivot.x=d.pivot.x=.5,c.pivot.y=d.pivot.y=.5,d.addChild(e),d.addChild(f),$(b.view).attr("id","canvas"),this.winResize();var g=this;this.loadSprites(function(){g.spritesLoaded=!0,a()}),Eye_color=Conf.SKIN_DETAILS},this.setGridMain=function(a,b,c){this.setupGrid(a,b,c)},this.showPlayerBlock=function(){for(var a=this.player.position,b={x:a.x-this.winWidth/2,y:a.y-this.winHeight/2,width:this.winWidth,height:this.winHeight},c=this.getGridBlockFor(b.x,b.y,0),d=this.getGridBlockFor(b.x+b.width,b.y,1),e=this.getGridBlockFor(b.x,b.y+b.height,3),f=c.y*NO_OF_WBLOCKS+c.x,g=d.y*NO_OF_WBLOCKS+d.x,h=e.y-c.y,i=[],j=0;j<=h;j++)for(var k=f;k<=g;k++)pushArr(i,+(k+j*NO_OF_WBLOCKS));for(var l=0;l<i.length;l++)n[i[l]].show()},this.flushShootBar=function(){h.flush()},this.setCamera=function(a){this.reset(),this.player=a;var e=a.getGraphic();null!==this.camera&&void 0!==this.camera||(this.camera=new Camera(d,b.view.width,b.view.height,e),this.camera.zoom=1,this.winResize(),c.addChild(this.camera))},this.loadImg=function(a,b){loader.add(a).load(b)},this.loadM_Img=function(a,b){for(var c=[],d=0,e=0,f=a.length;e<f;e++)a[e].length>0&&(c[d++]=""+a[e]);d=0,loader.add(c).load(b)},this.loadSprites=function(a){this.loadImg(j,this.loadSpritesCallback.bind(this,a))},this.loadSpriteImg=function(a,b){this.loadImg([a],this.loadSpritesCallback.bind(this,b))},this.loadSpritesCallback=function(a){a()},this.setupPortal=function(){var a=new Graphics;return a.beginFill(65280),a.lineStyle(4,0,1),a.drawCircle(0,0,20),a.endFill(),a.filter=[],a},this.playerSetCallback=function(){},this.setupBullet=function(){var a=Resources[Conf.FILES[Conf.FILESI.bullet]].texture,b=new Sprite(a);return b.anchor.x=Conf.P_A,b.anchor.y=Conf.P_A,b.scale.x=Conf.BULL_SCALE,b.scale.y=Conf.BULL_SCALE,b.displayGroup=p,f.addChild(b),b},this.DOM_createAreaZones=function(a){var b=new Graphics;b.beginFill(C_RED,.8),b.lineStyle(5,C_RED,.8),b.drawRect(0,0,a.r.s,a.r.s),b.beginFill(C_RED,.8),b.lineStyle(5,C_RED,.8),b.drawRect(a.r.x,a.r.y,a.r.s,a.r.s),b.beginFill(C_GREEN,.8),b.lineStyle(5,C_GREEN,.8),b.drawRect(a.g.x,a.g.y,a.g.s,a.g.s),b.beginFill(C_BLUE,.8),b.lineStyle(5,C_BLUE,.8),b.drawRect(a.b.x,a.b.y,a.b.s,a.b.s),b.displayGroup=p,e.addChild(b)},this.setBar=function(){h=new ShootBar(.5*this.winWidth,.93*this.winHeight),h.set(c,p)},this.initLB_clrs=function(a){c.addChild(a);for(var b=[Conf.LB_CLRS[0].c,Conf.LB_CLRS[1].c,Conf.LB_CLRS[2].c],d=0;d<7;d++)b.push(Conf.LB_CLRS[Math.floor(7*Math.random()+3)].c);return b},this.createLB_counting=function(a,b){for(var c=.13*this.winWidth,d=new Array(10),e=Conf.LB_CLR_FALL,f=Conf.LB_CLR_START,g=.27*this.winHeight,h=.99*this.winWidth,i=.01*this.winHeight,j=0;j<10;j++){var k="#"+(j+1),l=new PIXI.Text(k,{stroke:0,strokeThickness:1,fill:b[j],fontSize:15});l.anchor.x=0,l.anchor.y=.5,l.alpha=j>=5?f-j*e:f,l.displayGroup=q,l.x=h-c+.05*c,9==j&&(l.x=h-c+.05*c-8),l.y=i+.08*g+.1*g+.08*g*j,a.addChild(l),pushArr(d,l)}return[d,b]},this.createLB_names=function(a,b){for(var c=Conf.LB_CLR_FALL,d=Conf.LB_CLR_START,e=.13*this.winWidth,f=new Array(10),g=.27*this.winHeight,h=.99*this.winWidth,i=.01*this.winHeight,j=0;j<10;j++){var k=new PIXI.Text("boomgamer",{stroke:3355443,strokeThickness:2,fill:b[j],fontSize:15});k.anchor.x=0,k.anchor.y=.5,k.alpha=j>=5?d-j*c:d,k.displayGroup=q,k.x=h-e+.2*e,k.y=i+.08*g+.1*g+.08*g*j,a.addChild(k),pushArr(f,k)}return f},this.createLB_scores=function(a,b){for(var c=.13*this.winWidth,d=new Array(10),e=.27*this.winHeight,f=.99*this.winWidth,g=.01*this.winHeight,h=0;h<10;h++){var i=new PIXI.Text("2222",{stroke:3355443,strokeThickness:2,fill:b[h],fontSize:15});i.anchor.x=0,i.anchor.y=.5,i.alpha=h>=5?.8-.08*h:.8,i.displayGroup=q,i.x=f-c+.7*c,i.y=g+.08*e+.1*e+.08*e*h,a.addChild(i),pushArr(d,i)}return d},this.createLB_rect=function(a){var b=Resources[Conf.FILES[Conf.FILESI.fr]].texture,c=new Sprite(b),d=.13*this.winWidth,e=.27*this.winHeight,f=.99*this.winWidth,g=.01*this.winHeight;c.anchor.x=c.anchor.y=0,c.scale.x=c.scale.y=.6,c.x=f-d+3,c.y=g+.06*e,c.alpha=.8,c.rotation=-.25;var h=new Graphics;h.beginFill(3355443,.16),h.lineStyle(1,11184810,.1),h.drawRect(f-d,g,d,e),h.endFill();var i=new PIXI.Text("Leaderboard",{stroke:3355443,strokeThickness:2,fill:16777215,fontSize:22});return i.alpha=.9,i.anchor.x=i.anchor.y=.5,i.displayGroup=q,i.x=f-d/2,i.y=g+.08*e,h.displayGroup=p,a.addChild(h),a.addChild(c),a.addChild(i),[h,i]},this.pushPlName=function(a,b,c){},this.getTex=function(a){var b=(""+a).trim();return Resources[b].texture},this.updatePlayerEyes=function(a,b,c){var d=Resources[Conf.FILES[Conf.FILESI.pcirclefill]].texture,e=new Sprite(d);e.anchor.y=e.anchor.x=Conf.P_A,e.tint=16711680,e.alpha=0,e.name="cover";var f=0,g="b",h=Conf.EYE_CLR[g];b&&Eye_color&&c&&(g=Eye_color[""+c].eyes||"b",h=Conf.EYE_CLR[g]);var i=new Graphics;a[1].removeChildAt(2);var j=0,k=0,l=[8.6,1.35,2.4,5],d=Resources[Conf.FILES[Conf.FILESI.pcirclefill]].texture,m=new Sprite(d);m.scale.y=m.scale.x=Conf.P_I_SKIN,j=m.x+m.width/l[mmin(l.length-1,f++)]-m.width/2,offset=m.width/l[mmin(l.length-1,f++)],k=m.y+m.height/l[mmin(l.length-1,f++)]-m.height/2,i.beginFill(h,.9),i.drawCircle(j,k,l[mmin(l.length-1,f)]+1),i.drawCircle(j+offset,k,l[mmin(l.length-1,f)]+1),i.endFill(),i.beginFill("0x000000",0),i.lineStyle(2,0,1),i.drawCircle(j,k,l[mmin(l.length-1,f)]+2),i.drawCircle(j+offset,k,l[mmin(l.length-1,f)]+2),i.endFill(),i.beginFill("0x000000",1),i.drawCircle(j,k,l[mmin(l.length-1,f)]-3),i.drawCircle(j+offset,k,l[mmin(l.length-1,f)]-3),i.endFill(),i.name="eyes",a[1].addChild(i),a[1].addChild(e)},this.setupHealthEffect=function(a){},this.clearContainer=function(){var a=0;return function(b){for(;b.children.length>0;)a++,this.clearContainer(b.children[0]);a=0,b.parent.removeChild(b),b=void 0}}(),this.reset=function(){this.camera&&(this.camera.reset(),this.camera=void 0,c.removeChild(this.camera))},this.clearPlContainers=function(a){this.clearContainer(f),d.addChild(f),a()},this.setupPlayer=function(){var a,b=Resources[Conf.FILES[Conf.FILESI.pcircle]].texture,c=Resources[Conf.FILES[Conf.FILESI.pcirclefill]].texture,d=Resources[Conf.FILES[Conf.FILESI.pcircleouter]].texture,e=(Resources[Conf.FILES[Conf.FILESI.healthbar]].texture,0),g=0,h=Conf.PNAME_CLRS[Math.floor(4*Math.random())],i=new Graphics,j=new Graphics,k=new Sprite(b),l=new Sprite(c),m=new Sprite(c),n=[8.6,1.35,2.4,5],o=0,q=new PIXI.Text(" ",{stroke:3355443,strokeThickness:2,fill:h,fontSize:15});q.scale.x=q.scale.y=1,k.alpha=1,m.scale.x=m.scale.y=.9,l.scale.y=l.scale.x=Conf.P_I_SKIN,e=l.x+l.width/n[mmin(n.length-1,o++)]-l.width/2,offset=l.width/n[mmin(n.length-1,o++)],g=l.y+l.height/n[mmin(n.length-1,o++)]-l.height/2,a=1.5*l.width,i.beginFill(16711680,.9),i.drawCircle(e,g,n[mmin(n.length-1,o)]),i.drawCircle(e+offset,g,n[mmin(n.length-1,o)]),i.endFill(),i.name="eyes";var r=new PIXI.Text("",{stroke:1118481,strokeThickness:1,fill:h,fontSize:38});r.scale.x=r.scale.y=1;var s=new Sprite(d),t=new PIXI.Text("",{stroke:1118481,strokeThickness:2,fill:h,fontSize:38});return j.beginFill(16711680,.9),j.drawRect(l.x-a,l.y-l.height/4,2*a,l.height/2),j.drawCircle(e+offset,g,4),j.alpha=.7,j.endFill(),t.anchor.x=t.anchor.y=r.anchor.x=r.anchor.y=m.anchor.x=m.anchor.y=l.anchor.y=l.anchor.x=k.anchor.y=k.anchor.x=Conf.ZERO_5,r.alpha=.8,r.scale.x=r.scale.y=t.scale.x=t.scale.y=.6,r.interactive=!1,t.interactive=!1,s.anchor.y=s.anchor.x=Conf.ZERO_5,s.scale.y=s.scale.x=1,s.tint=Conf.P_O_T,s.alpha=Conf.P_O_A,l.addChild(m),l.addChild(k),l.addChild(i),k.displayGroup=p,f.addChild(t),f.addChild(s),f.addChild(l),f.addChild(r),[s,l,t,r]},this.resetDeadSprites=function(a){var b=a.gs,c=Object.keys(b),d=0,e={};if(c.length>0)for(var f=0;f<c.length;f++)if(d=b[c[f]]||[],""!==(e=n[mmax(0,c[f])]||""))for(var g=0;g<d.length;g++)e.resetGroundSprites(d[g])},this.saveAndGetColor=function(a){var b=fMath.hex_rgb(a);return this.playerColorTable[""+a]=b,b},this.baseColorSet=function(a,b,c){for(var d,e=b.split("#"),f=e[0].split(","),g=0;g<f.length;g++)d=f[g].split("_"),n[d[2]-1].setStartGridClrs(d[0]+"_"+d[1],a.color)},this.gridChangeServ=function(a,b,c,d){var e,f,g=0,h={},i=0,j=0,k="";for(g=0,len=a.length;g<len;g++)f=a[g].slice(1).split("_"),i=f[3],j=Number(f[4]),k=f[0]+"_"+f[1],this.player.id===i?h=this.player||"":c[""+i]&&(h=c[""+i]||""),""!==h&&(e=h.color),this.gridNames[k]=this.gridNames[k]||"",""!==this.gridNames[k]?this.pushPlNameOnGrid(h.name,f[0],f[1]):j>=37&&j%37==0&&this.pushPlNameOnGrid(h.name,f[0],f[1]),h.pushColorSprite(k,f[2]-1),n[mmax(0,f[2]-1)].stepOnGrid(k,e,h);var l=[],m="",f=[],o="";for(g=0,len=b.length;g<len;g++)l=b[g].slice(1).split("."),m=l[0],f=m.split("_"),o=l[1].split("_"),i=o[3],this.player.id===i?h=this.player||"":c[""+i]&&(h=c[""+i]||""),n[mmax(0,f[2]-1)].hideDotFromServ(m,o,h.position)},this.changeScaleDelta=function(a){f&&this.camera.setZoom(a)},this.createLeaderboard=function(){},this.setupWorldGridBlocks=function(){for(var a=-i/2,b=-i/2,c=0,d=0,e=0,f=k,g=i/f,h=0;h<g;h++){d=b+h*f,o.push(d);for(var j=0;j<g;j++)c=a+j*f,n.push(new WorldGridBlock(c,d,f,h+1,++e))}},
this.getGridBlockFor=function(a,b,c){return{x:mmin(NO_OF_WBLOCKS-1,mmax(0,Math.floor((a+i/2)/k))),y:mmin(NO_OF_WBLOCKS-1,mmax(0,Math.floor((b+i/2)/k)))}},this.setupGrid=function(a,b,c){var d=this;if(!c){this.setupWorldGridBlocks();var f=Resources[Conf.FILES[Conf.FILESI.gridele]].texture;width=gridEleSize*gridEleScale;for(var h=n,j=h.length,k=0;k<j;k++)h[k].setBlocks(e,p,f,width),h[k].setDots(e,p)}d.showPlayerBlock.bind(d)(),a(),b(),g=new WorldBoundary(-i/2,-i/2,i,i),g.setBoundary(e,p)},this.cullView=function(){for(var a=this.player.position,b={x:a.x-this.winWidth/2,y:a.y-this.winHeight/2,width:this.winWidth,height:this.winHeight},c=this.getGridBlockFor(b.x,b.y,0),d=this.getGridBlockFor(b.x+b.width,b.y,1),e=this.getGridBlockFor(b.x,b.y+b.height,3),f=c.y*NO_OF_WBLOCKS+c.x,g=d.y*NO_OF_WBLOCKS+d.x,h=e.y-c.y,i="",j=0;j<=h;j++)for(var k=f;k<=g;k++)i+=k+j*NO_OF_WBLOCKS+"_";if(i=i.slice(0,-1),this.lastPatt!==i){for(var l=i.split("_"),m=this.lastPatt.split("_"),o=0;o<l.length;o++)l[o]=+l[o];for(var p=0;p<m.length;p++)m[p]=+m[p];var q=l.slice();l=l.filter(function(a){return-1==m.indexOf(a)}),m=m.filter(function(a){return-1==q.indexOf(a)});for(var r=0;r<l.length;r++)n[l[r]].show();for(var s=0;s<m.length;s++)n[m[s]].hide();this.lastPatt=i}},this.showVisibleBlockCount=function(){for(var a=0,b=0;b<n.length;b++)n[b].isVisible()&&a++},this.renderWorld=function(a,d,e){if(this.camera){var f=Date.now();a.updateGraphic(e);var h=[b.view.width,b.view.height];Object.keys(d).forEach(function(a,b){d[""+a].updateGraphic(e)}),++m%7==0&&(this.cullView(),g.update(e));for(var i=n,j=i.length,k=0;k<j;k++)i[k].isVisible()&&i[k].update(e,a.position,h);this.camera.update(e),b.render(c);Date.now()}}};module.exports=Renderer;